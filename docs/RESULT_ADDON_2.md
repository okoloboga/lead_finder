# Discovery: –ú–æ–¥—É–ª—å —Å–±–æ—Ä–∞ –±–æ–ª–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (ADDON_2.md)

## 1. Problem Statement

### –ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç
Lead Finder —É–∂–µ –ø–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram-—á–∞—Ç–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª–∏–¥–æ–≤. –ü–æ–±–æ—á–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç ‚Äî **—Å–æ—Ç–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –±–æ–ª—è–º–∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π**, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –Ω–∏–∫–∞–∫ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### –¶–µ–ª—å
–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–≤–∞ –∞–∫—Ç–∏–≤–∞:
1. **–ë–∞–∑–∞ –±–æ–ª–µ–π** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è, —Å —Ç—Ä–µ–Ω–¥–∞–º–∏
2. **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞** ‚Äî —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –ø–æ—Å—Ç–æ–≤ –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –±–æ–ª–µ–π

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞: 1 —á–∞—Å ‚Üí 15 –º–∏–Ω—É—Ç (—á–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç –±–æ—Ç–∞ + —Ä–µ–¥–∞–∫—Ç—É—Ä–∞)
- –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (‚â•3 —Ü–∏—Ç–∞—Ç –∏–∑ —á–∞—Ç–æ–≤)
- –ë–æ–ª–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

---

## 2. Scope

### In Scope (MoSCoW)

**Must Have:**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–π –∏–∑ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –ª–∏–¥–æ–≤) —á–µ—Ä–µ–∑ LLM –±–∞—Ç—á–∞–º–∏
- –¢–∞–±–ª–∏—Ü—ã `pains`, `pain_clusters`, `generated_posts` –≤ PostgreSQL
- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–æ–ª–µ–π —á–µ—Ä–µ–∑ LLM –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –ö–Ω–æ–ø–∫–∞ "–ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –±–æ—Ç–∞
- –¢–æ–ø –±–æ–ª–µ–π —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø–æ—Å—Ç–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É (3 —Ç–∏–ø–∞)
- –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ø—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

**Should Have:**
- –î–µ—Ç–∞–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
- –§–æ—Ä–º—É–ª–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å freshness/intensity/already_posted
- –¢—Ä–µ–Ω–¥—ã (growing/stable/declining)

**Could Have:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è (–≤–∫–ª/–≤—ã–∫–ª, –º–∏–Ω. –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ–ª–µ–π –≤ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –±–æ—Ç–∞

**Won't Have (this iteration):**
- –ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª
- –í–µ–∫—Ç–æ—Ä–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è (embeddings)
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç –Ω–∞–ø—Ä—è–º—É—é

### Out of Scope
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏–¥–æ–≤
- –†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É–∂–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∑–∞–ø—É—Å–∫–∏)
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –ø—Ä–æ–º–ø—Ç–æ–≤

---

## 3. Technical Context

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—á—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ß—Ç–æ –¥–∞—ë—Ç |
|-----------|------|----------|
| –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π | `modules/members_parser.py` | –£–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (text, message_id, chat_id, link, date, freshness) |
| LLM-–∫–ª–∏–µ–Ω—Ç | `modules/qualifier.py` | `langchain_openai.ChatOpenAI` —á–µ—Ä–µ–∑ CometAPI (gpt-4o) |
| ORM | `bot/models/` | SQLAlchemy 2.0 async, PostgreSQL |
| Bot UI | `bot/handlers/`, `bot/ui/` | aiogram 3.x, InlineKeyboard, FSM |
| –ü—Ä–æ–º–ø—Ç—ã | `prompts/` | –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ runtime |

### –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**1. `members_parser.py` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Pain Collector**

–°–µ–π—á–∞—Å `parse_users_from_messages()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (users). –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ **–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞—Ä—É–∂—É** ‚Äî –æ–Ω–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ user_id –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `user_messages_dict`.

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- **(A) –í–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º** ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å return type –Ω–∞ tuple `(candidates, all_messages)`. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –µ—Å–ª–∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ.
- **(B) Callback-–ø–æ–¥—Ö–æ–¥** ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `on_messages_collected` callback –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `on_lead_found`. –ë–æ–ª–µ–µ —á–∏—Å—Ç—ã–π, –Ω–µ –º–µ–Ω—è–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—É return.
- **(C) –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥** ‚Äî Pain Collector —Å–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç `client.iter_messages()`. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API, –ª–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –≤–∞—Ä–∏–∞–Ω—Ç (A)** ‚Äî –ø—Ä–æ—â–µ, –ø–æ–Ω—è—Ç–Ω–µ–µ, –æ–¥–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ return.

**2. `program_runner.py` ‚Äî –∑–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏**

–ü–æ—Å–ª–µ `run_program_pipeline()` ‚Äî –≤—ã–∑–æ–≤ `pain_clusterer.cluster_new_pains(program_id)`. –õ–æ–≥–∏—á–Ω–æ–µ –º–µ—Å—Ç–æ ‚Äî –≤ –∫–æ–Ω—Ü–µ –ø–∞–π–ø–ª–∞–π–Ω–∞, –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º summary.

**3. `bot/ui/main_menu.py` ‚Äî –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞**

–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üî• –ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç" –º–µ–∂–¥—É "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏".

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å | –†–∏—Å–∫ |
|-------------|--------|------|
| PostgreSQL | –ï—Å—Ç—å | –ù–µ—Ç ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î |
| SQLAlchemy async | –ï—Å—Ç—å | –ù–µ—Ç |
| LangChain + CometAPI | –ï—Å—Ç—å | –ù–∏–∑–∫–∏–π ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ LLM-–≤—ã–∑–æ–≤—ã (~$0.03/–∑–∞–ø—É—Å–∫) |
| aiogram 3.x | –ï—Å—Ç—å | –ù–µ—Ç |
| Telethon (–ø–∞—Ä—Å–∏–Ω–≥) | –ï—Å—Ç—å | –ù–µ—Ç ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ |

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
modules/
‚îú‚îÄ‚îÄ pain_collector.py       # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–π –±–∞—Ç—á–∞–º–∏ —á–µ—Ä–µ–∑ LLM
‚îú‚îÄ‚îÄ pain_clusterer.py       # –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –±–æ–ª–µ–π —á–µ—Ä–µ–∑ LLM
‚îî‚îÄ‚îÄ content_generator.py    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –ø–æ—Å—Ç–æ–≤

bot/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ pain.py             # ORM: Pain, PainCluster, GeneratedPost
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ pains_handler.py    # –í—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã UI –±–æ–ª–µ–π –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ ui/
    ‚îî‚îÄ‚îÄ pains_menu.py       # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

prompts/
‚îú‚îÄ‚îÄ pain_extraction.txt     # –ü—Ä–æ–º–ø—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–æ–ª–µ–π
‚îú‚îÄ‚îÄ pain_clustering.txt     # –ü—Ä–æ–º–ø—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ content_generation.txt  # –ü—Ä–æ–º–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤
```

---

## 4. Assumptions & Risks

### Assumptions

| # | –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ |
|---|---------------|---------------------|
| A1 | 500 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –∑–∞–ø—É—Å–∫ ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä—ë–º –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–æ–ª–µ–π | –ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö ‚Üí –ø—É—Å—Ç—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã. –ú–∏—Ç–∏–≥–∞—Ü–∏—è: —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –∏–ª–∏ –ø–∞—Ä—Å–∏—Ç—å –±–æ–ª—å—à–µ —á–∞—Ç–æ–≤ |
| A2 | LLM (gpt-4o) –Ω–∞–¥—ë–∂–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –±–æ–ª–∏ –∏–∑ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö —á–∞—Ç–æ–≤ | –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ ‚Üí –º—É—Å–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –∏—Ç–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| A3 | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ LLM —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ ~100 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ | –ü—Ä–∏ >100 –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç LLM –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è. –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –º–µ—Ä–∂ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏–ª–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è |
| A4 | –ë–∞—Ç—á 20-30 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è | –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –±–∞—Ç—á ‚Üí –ø–æ—Ç–µ—Ä—è –±–æ–ª–µ–π. –ú–∏—Ç–∏–≥–∞—Ü–∏—è: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ |
| A5 | CometAPI –Ω–µ —É–ø–∞–¥—ë—Ç –æ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ~17 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –∑–∞–ø—É—Å–∫ | Rate limit. –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏, retry logic |

### Risks

| # | –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|---|------|-------------|---------|-----------|
| R1 | LLM –≤—ã–∑–æ–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ (llm.invoke –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop) | –í—ã—Å–æ–∫–∞—è (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω) | –ë–æ—Ç –∑–∞–≤–∏—Å–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª–µ–π | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ainvoke` –∏–ª–∏ `asyncio.to_thread()` |
| R2 | –ù–µ—Ç retry –Ω–∞ LLM-–≤—ã–∑–æ–≤–∞—Ö | –í—ã—Å–æ–∫–∞—è | –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—à–∏–±–∫–µ API | –î–æ–±–∞–≤–∏—Ç—å retry —Å backoff (–∫–∞–∫ –≤ CLAUDE.md –ø–∞—Ç—Ç–µ—Ä–Ω–µ) |
| R3 | –î—É–±–ª–∏–∫–∞—Ç—ã –±–æ–ª–µ–π –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö | –°—Ä–µ–¥–Ω—è—è | –†–∞–∑–¥—É—Ç–∞—è –ë–î, –∏—Å–∫–∞–∂—ë–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è—Ç—å source_message_id + source_chat –ø–µ—Ä–µ–¥ insert |
| R4 | –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–æ–ª–µ–π | –°—Ä–µ–¥–Ω—è—è | –ú—É—Å–æ—Ä–Ω—ã–µ –∏–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –±–æ–ª–∏ | 2-3 –∏—Ç–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| R5 | –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ | –ù–∏–∑–∫–∞—è | –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤ | Regex + LLM-–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π |

### Blockers

**–ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–µ—Ä–æ–≤.** –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –º–µ—Å—Ç–µ, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å –±–µ–∑ –ª–æ–º–∞—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### Open Questions

| # | –í–æ–ø—Ä–æ—Å | –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é |
|---|--------|----------------------|
| Q1 | –ù—É–∂–µ–Ω –ª–∏ `program_id` –≤ –±–æ–ª—è—Ö? –ò–ª–∏ –±–æ–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ? | –°–ø–µ–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç program_id ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ |
| Q2 | –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –±–æ–ª–µ–π: –ø–æ message_id –∏–ª–∏ –ø–æ —Ç–µ–∫—Å—Ç—É? | –ü–æ message_id ‚Äî –æ–¥–∏–Ω message –º–æ–∂–µ—Ç –¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª–µ–π, –Ω–æ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞—Ä—Å–∏—Ç—å—Å—è –¥–≤–∞–∂–¥—ã |
| Q3 | config.PAIN_COLLECTION_ENABLED ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∏–ª–∏ per-program? | –ù–∞—á–∞—Ç—å —Å –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –≤ config.py, –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å per-program |

---

## 5. Implementation Roadmap (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π)

### –≠—Ç–∞–ø 1: –Ø–¥—Ä–æ (Pain Collector)
- ORM –º–æ–¥–µ–ª–∏ (Pain, PainCluster, GeneratedPost)
- `pain_collector.py` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–π –±–∞—Ç—á–∞–º–∏
- –ü—Ä–æ–º–ø—Ç `pain_extraction.txt`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `members_parser.py` (return all_messages)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `program_runner.py` (–≤—ã–∑–æ–≤ collector –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ source_message_id + source_chat

### –≠—Ç–∞–ø 2: –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
- `pain_clusterer.py` ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ LLM
- –ü—Ä–æ–º–ø—Ç `pain_clustering.txt`
- –ü–µ—Ä–µ—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –†–∞—Å—á—ë—Ç —Ç—Ä–µ–Ω–¥–æ–≤

### –≠—Ç–∞–ø 3: Bot UI
- –ö–Ω–æ–ø–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
- –≠–∫—Ä–∞–Ω "–ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç" —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –¢–æ–ø –±–æ–ª–µ–π —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º
- –î–µ—Ç–∞–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏

### –≠—Ç–∞–ø 4: Content Generator
- `content_generator.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤
- –ü—Ä–æ–º–ø—Ç `content_generation.txt` (3 —Ç–∏–ø–∞)
- –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç
- UI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ + —á–µ—Ä–Ω–æ–≤–∏–∫–∏

---

## 6. –í—ã–≤–æ–¥

–ú–æ–¥—É–ª—å **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ä–µ–∞–ª–∏–∑—É–µ–º** –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- `members_parser.py` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (1 –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
- `program_runner.py` ‚Äî –≤—ã–∑–æ–≤ pain_collector –∏ pain_clusterer (2 —Å—Ç—Ä–æ–∫–∏)
- `main_menu.py` ‚Äî –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ (1 —Å—Ç—Ä–æ–∫–∞)

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî **–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã**, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—â–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–ª–Ω–∞—è.

**–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥**: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ LLM-–≤—ã–∑–æ–≤—ã (R1) –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry (R2) ‚Äî —Å—Ç–æ–∏—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** `/plan` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º.
