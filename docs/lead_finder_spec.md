# LeadSense — Техническое задание

## Обзор проекта

### Цель
Автоматизированная система поиска B2B лидов для фриланс-агентства, специализирующегося на разработке Telegram-ботов и Mini Apps.

### Ключевая задача
На вход подаётся описание целевой ниши (например, "селлеры Wildberries", "логистические компании"). На выходе — готовые карточки лидов с контактами, анализом бизнеса, выявленными болями и рекомендациями по первому сообщению для холодного аутрича.

### Целевая аудитория лидов
- Селлеры маркетплейсов (WB, Ozon)
- Малый и средний бизнес (логистика, перевозки, услуги)
- Владельцы локального бизнеса с потенциалом автоматизации

---

## Архитектура системы

### Общая схема пайплайна

```
[Ввод: описание ниши]
        ↓
[Модуль поиска каналов] — GPT + Web Search
        ↓
[Модуль парсинга Telegram] — Telethon
        ↓
[Модуль квалификации] — GPT анализ
        ↓
[Модуль вывода] — карточки лидов
```

### Компоненты системы

#### 1. Search Module (Поиск каналов)
**Ответственность:** Поиск Telegram-каналов и контактов бизнесов по заданной нише.

**Входные данные:**
- Текстовое описание ниши от пользователя
- Опциональные параметры фильтрации (регион, размер бизнеса)

**Выходные данные:**
- Список URL/username Telegram-каналов
- Дополнительные ссылки (сайты, соцсети), если найдены

**Логика работы:**
1. Принимает описание ниши
2. Формирует серию поисковых запросов для web search
3. Парсит результаты, извлекает ссылки на Telegram-каналы
4. Дедуплицирует результаты
5. Возвращает список каналов для дальнейшей обработки

**Поисковые стратегии:**
- Прямой поиск: "telegram канал селлеры wildberries"
- Поиск списков: "лучшие telegram каналы для селлеров 2024"
- Поиск по персонам: "telegram блог владельца бизнеса логистика"
- Поиск по болям: "автоматизация для селлеров wb telegram"

#### 2. Telegram Parser Module (Парсинг Telegram)
**Ответственность:** Сбор информации о канале и его владельце через Telegram API.

**Входные данные:**
- Username или URL Telegram-канала

**Выходные данные:**
- Метаданные канала (название, описание, количество подписчиков)
- Последние N постов (текст, дата, просмотры)
- Контактная информация (username владельца/админа, ссылки из описания)
- Связанные ресурсы (сайт, другие соцсети из био)

**Логика работы:**
1. Подключается к каналу через Telethon
2. Извлекает базовую информацию о канале
3. Загружает последние 30-50 постов
4. Извлекает контакт владельца (из описания, закреплённых сообщений, или как админа)
5. Парсит ссылки на внешние ресурсы
6. Формирует структурированный объект с данными

**Обработка ошибок:**
- Приватный канал — пропустить, залогировать
- Канал не существует — пропустить, залогировать
- Rate limiting — экспоненциальный backoff

#### 3. Qualifier Module (Квалификация лидов)
**Ответственность:** Анализ собранных данных и определение качества лида.

**Входные данные:**
- Структурированные данные о канале из Parser Module
- Контекст целевой ниши

**Выходные данные:**
- Оценка релевантности (1-10)
- Тип бизнеса и его описание
- Выявленные боли и потребности
- Идеи продуктов/решений для этого лида
- Рекомендованное первое сообщение
- Причины оценки (для отладки)

**Критерии квалификации:**
- Это личный канал владельца бизнеса, а не медиа/новости?
- Есть ли признаки активного бизнеса (не заброшен)?
- Виден ли масштаб бизнеса?
- Есть ли явные или неявные боли в постах?
- Релевантен ли бизнес для услуг Telegram-разработки?

**Промпт-инструкция для LLM:**
```
Контекст: Анализируем потенциального клиента для агентства, 
которое разрабатывает Telegram-ботов и Mini Apps.

Задача: На основе информации о Telegram-канале определить:

1. ТИП БИЗНЕСА
   - Чем занимается владелец канала?
   - Какой примерный масштаб (микро/малый/средний)?
   - Ниша и специализация

2. КВАЛИФИКАЦИЯ
   - Это владелец бизнеса или медиа/блогер?
   - Активен ли бизнес (по частоте и содержанию постов)?
   - Оценка от 1 до 10, где 10 — идеальный лид

3. БОЛИ И ПОТРЕБНОСТИ
   - Какие проблемы явно или неявно упоминаются?
   - Что можно автоматизировать в его бизнесе?
   - Какие процессы могут быть улучшены ботом?

4. ИДЕЯ РЕШЕНИЯ
   - Конкретная идея Telegram-бота или Mini App
   - Какую боль это закроет
   - Примерная ценность для клиента

5. ПЕРВОЕ СООБЩЕНИЕ
   - Персонализированное сообщение для холодного аутрича
   - Упоминание конкретной боли или контекста из канала
   - Короткое, без агрессивных продаж
```

#### 4. Output Module (Вывод результатов)
**Ответственность:** Форматирование и сохранение результатов.

**Форматы вывода:**
- JSON-файл с полными данными (для программной обработки)
- Markdown-отчёт (для чтения)
- CSV (для импорта в CRM/таблицы)

**Структура карточки лида:**
```
{
  "id": "unique_id",
  "timestamp": "ISO datetime",
  "source_query": "исходный запрос ниши",
  
  "contact": {
    "telegram_username": "@username",
    "telegram_channel": "@channel или t.me/channel",
    "website": "url если найден",
    "other_links": []
  },
  
  "channel_data": {
    "name": "название канала",
    "description": "описание",
    "subscribers": 1234,
    "recent_posts_count": 50,
    "last_post_date": "ISO datetime",
    "sample_posts": ["выдержки из постов"]
  },
  
  "qualification": {
    "score": 8,
    "business_type": "Селлер WB, детская одежда",
    "business_scale": "малый",
    "is_business_owner": true,
    "is_active": true,
    "reasoning": "почему такая оценка"
  },
  
  "analysis": {
    "identified_pains": ["боль 1", "боль 2"],
    "automation_opportunities": ["возможность 1"],
    "product_ideas": [
      {
        "idea": "Бот для автоответов на отзывы",
        "pain_addressed": "тратит много времени на отзывы",
        "estimated_value": "экономия 10+ часов в неделю"
      }
    ]
  },
  
  "outreach": {
    "recommended_message": "текст первого сообщения",
    "key_hooks": ["зацепка 1", "зацепка 2"]
  }
}
```

---

## MVP: Минимально жизнеспособный продукт

### Scope MVP
Консольный скрипт, который:
1. Принимает описание ниши как аргумент
2. Ищет каналы через GPT + Web Search
3. Парсит найденные каналы через Telethon
4. Квалифицирует через GPT
5. Сохраняет результаты в JSON и Markdown

### Ограничения MVP
- Без GUI/бота — только CLI
- Без базы данных — файловое хранение
- Без автоматического расписания — ручной запуск
- Один источник поиска — только web search
- Без параллельной обработки — последовательно

### Что НЕ входит в MVP
- Telegram-бот интерфейс
- Интеграция с CRM
- Автоматическая отправка сообщений
- Трекинг статусов лидов
- Множественные источники данных (TGStat, парсинг чатов)

---

## Структура проекта

```
leadsense/
├── main.py                 # Точка входа, CLI интерфейс
├── config.py               # Конфигурация и API ключи
├── modules/
│   ├── __init__.py
│   ├── search.py           # Поиск каналов через GPT + Web Search
│   ├── telegram_parser.py  # Парсинг Telegram через Telethon
│   ├── qualifier.py        # Квалификация лидов через GPT
│   └── output.py           # Форматирование и сохранение результатов
├── prompts/
│   ├── search_queries.txt  # Шаблоны поисковых запросов
│   └── qualification.txt   # Промпт для квалификации
├── output/                 # Директория для результатов
│   ├── leads_YYYYMMDD_HHMMSS.json
│   └── leads_YYYYMMDD_HHMMSS.md
├── logs/                   # Логи выполнения
├── requirements.txt        # Зависимости Python
├── .env.example            # Пример файла с переменными окружения
└── README.md               # Инструкция по запуску
```

---

## Конфигурация

### Переменные окружения (.env)

```
# OpenAI API
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o          # или gpt-4o-mini для экономии

# Telegram API (получить на my.telegram.org)
TELEGRAM_API_ID=12345678
TELEGRAM_API_HASH=abcdef1234567890
TELEGRAM_PHONE=+79001234567   # для авторизации Telethon

# Настройки парсинга
POSTS_TO_FETCH=50             # количество постов для анализа
MAX_CHANNELS_PER_SEARCH=20    # лимит каналов за один запуск
SEARCH_QUERIES_COUNT=5        # количество поисковых запросов

# Настройки квалификации
MESSAGE_MAX_AGE_DAYS=10       # учитывать только сообщения за последние N дней
# min_score настраивается для каждой программы отдельно (в боте или CLI --min-score)
```

### Настройки по умолчанию (config.py)

```
DEFAULT_CONFIG = {
    "search": {
        "queries_per_niche": 5,
        "max_results_per_query": 10,
        "deduplicate": True
    },
    "parser": {
        "posts_limit": 50,
        "include_comments": False,
        "timeout_seconds": 30
    },
    "qualifier": {
        "min_score": 5,
        "include_reasoning": True
    },
    "output": {
        "formats": ["json", "markdown"],
        "include_raw_data": False
    }
}
```

---

## Зависимости

### Python пакеты (requirements.txt)

```
openai>=1.0.0        # GPT API + Web Search
telethon>=1.34.0     # Telegram API
python-dotenv>=1.0.0 # Переменные окружения
aiohttp>=3.9.0       # Async HTTP (для Telethon)
```

### Внешние сервисы
- OpenAI API с доступом к web search
- Telegram API (бесплатно, регистрация на my.telegram.org)

---

## Алгоритм работы (детально)

### Шаг 1: Инициализация
1. Загрузить конфигурацию из .env
2. Инициализировать OpenAI клиент
3. Инициализировать Telethon клиент (с авторизацией при первом запуске)
4. Создать директории для output и logs

### Шаг 2: Поиск каналов
1. Получить описание ниши от пользователя
2. Сгенерировать N поисковых запросов через GPT:
   - "telegram каналы {ниша}"
   - "блоги владельцев {ниша} telegram"
   - "лучшие каналы для {ниша} 2024"
   - и т.д.
3. Для каждого запроса выполнить web search
4. Извлечь из результатов ссылки на Telegram (t.me/*, @username)
5. Дедуплицировать список
6. Валидировать формат (отсеять явно невалидные)
7. Вернуть список каналов

### Шаг 3: Парсинг каналов
Для каждого канала из списка:
1. Подключиться к каналу через Telethon
2. Получить метаданные канала
3. Загрузить последние N постов
4. Извлечь контактную информацию:
   - Username из описания канала
   - Ссылки из био
   - Админы канала (если доступно)
5. Сформировать объект с данными
6. Обработать ошибки (приватный канал, не существует, rate limit)
7. Добавить задержку между запросами (1-3 сек)

### Шаг 4: Квалификация
Для каждого распарсенного канала:
1. Сформировать контекст для GPT:
   - Название и описание канала
   - Выдержки из последних постов
   - Ссылки и контакты
2. Отправить на анализ с промптом квалификации
3. Распарсить структурированный ответ
4. Отфильтровать по минимальному скору
5. Сформировать карточку лида

### Шаг 5: Вывод результатов
1. Сохранить полные данные в JSON
2. Сгенерировать читаемый Markdown-отчёт
3. Вывести саммари в консоль:
   - Всего найдено каналов: X
   - Успешно распарсено: Y
   - Квалифицировано (score >= min): Z
   - Файлы сохранены: paths

---

## Формат Markdown-отчёта

```markdown
# LeadSense Report
**Дата:** 2024-01-15 14:30
**Ниша:** Селлеры Wildberries
**Найдено лидов:** 12

---

## Лид #1 — Оценка: 9/10

**Контакт:** @ivan_seller
**Канал:** @ivan_wb_business (2,340 подписчиков)

### Бизнес
Селлер WB, ниша детская одежда. Оборот предположительно 2-5 млн/мес 
(судя по упоминаниям объёмов). Ведёт канал лично, делится опытом.

### Выявленные боли
- Жалуется на время, уходящее на ответы на отзывы
- Упоминал проблемы с отслеживанием остатков
- Писал о сложностях с аналитикой продаж

### Идея решения
**Бот для автоматизации работы с отзывами на WB**
- Уведомления о новых отзывах
- Шаблоны ответов с персонализацией
- Аналитика тональности отзывов

### Рекомендованное сообщение
> Привет! Читал твой канал — крутой контент про селлерство. 
> Заметил, что упоминал про время на отзывы. Делаю ботов для 
> автоматизации — есть идея, как сократить это в 5 раз. 
> Интересно глянуть?

---

## Лид #2 — Оценка: 8/10
...
```

---

## Обработка ошибок

### Критические ошибки (останавливают выполнение)
- Невалидный OpenAI API ключ
- Невалидные Telegram credentials
- Отсутствие интернет-соединения

### Некритические ошибки (логируются, выполнение продолжается)
- Приватный канал — пропустить
- Канал не существует — пропустить
- Timeout при парсинге — retry 2 раза, затем пропустить
- Ошибка квалификации — сохранить сырые данные без анализа
- Rate limit OpenAI — exponential backoff
- Rate limit Telegram — пауза 60 сек, retry

### Формат логов
```
[2024-01-15 14:30:15] INFO: Starting search for niche: "селлеры wb"
[2024-01-15 14:30:16] INFO: Generated 5 search queries
[2024-01-15 14:30:20] INFO: Found 23 unique channels
[2024-01-15 14:30:25] INFO: Parsing channel @channel1...
[2024-01-15 14:30:27] WARNING: Channel @channel2 is private, skipping
[2024-01-15 14:30:30] ERROR: Timeout parsing @channel3, retrying...
[2024-01-15 14:31:00] INFO: Qualifying lead @channel1...
[2024-01-15 14:31:05] INFO: Lead @channel1 qualified with score 8
[2024-01-15 14:32:00] INFO: Complete. Leads: 12, Saved to: output/leads_20240115_143200.json
```

---

## CLI интерфейс

### Базовый запуск
```bash
python main.py "селлеры wildberries"
```

### С параметрами
```bash
python main.py "логистика москва" --max-channels 30 --min-score 7 --output-dir ./results
```

### Доступные флаги
```
--max-channels N      Максимум каналов для обработки (default: 20)
--min-score N         Минимальный скор квалификации (default: 5)
--output-dir PATH     Директория для результатов (default: ./output)
--format FORMAT       Форматы вывода: json,md,csv (default: json,md)
--verbose             Подробный вывод в консоль
--dry-run             Только поиск, без парсинга и квалификации
```

---

## Оценка затрат

### Токены на один лид (примерно)
| Этап | Input tokens | Output tokens |
|------|--------------|---------------|
| Генерация поисковых запросов | 200 | 100 |
| Web search (на запрос) | 500 | 300 |
| Квалификация | 2000 | 500 |
| **Итого на лида** | ~3000 | ~1000 |

### Стоимость (GPT-4o)
- Input: $2.50 / 1M tokens
- Output: $10.00 / 1M tokens
- **На одного лида:** ~$0.02

### Стоимость (GPT-4o-mini) — рекомендуется для MVP
- Input: $0.15 / 1M tokens
- Output: $0.60 / 1M tokens
- **На одного лида:** ~$0.001

### Примерный бюджет
- 100 лидов в день на GPT-4o-mini: ~$0.10/день
- 100 лидов в день на GPT-4o: ~$2/день

---

## Развитие после MVP

### Фаза 2: Telegram-бот интерфейс
- Управление через Telegram-бота
- Получение результатов в чат
- Сохранение истории поисков

### Фаза 3: Дополнительные источники
- Интеграция TGStat API
- Парсинг участников чатов
- Парсинг 2GIS/справочников

### Фаза 4: Автоматизация
- Расписание автоматических поисков
- Трекинг статусов лидов
- Интеграция с CRM
- Уведомления о новых лидах

### Фаза 5: Масштабирование
- База данных для хранения лидов
- Дедупликация между запусками
- Аналитика конверсии
- A/B тестирование сообщений

---

## Чеклист готовности к разработке

- [ ] Получен OpenAI API ключ с доступом к web search
- [ ] Созданы Telegram API credentials на my.telegram.org
- [ ] Определена первая ниша для тестирования
- [ ] Настроено Python окружение (3.10+)
- [ ] Создана структура директорий проекта

---

## Контакты и ресурсы

### Документация
- OpenAI API: https://platform.openai.com/docs
- Telethon: https://docs.telethon.dev
- Telegram API: https://core.telegram.org/api

### Лимиты API
- OpenAI: зависит от тарифа, обычно 10K+ RPM
- Telegram: ~30 запросов в секунду, flood wait при превышении
