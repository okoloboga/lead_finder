# Plan: –ú–æ–¥—É–ª—å —Å–±–æ—Ä–∞ –±–æ–ª–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        EXISTING PIPELINE                        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  program_runner.py                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ Program  ‚îÇ‚îÄ‚îÄ‚îÄ>‚îÇ members_parser   ‚îÇ‚îÄ‚îÄ‚îÄ>‚îÇ  qualifier   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  .chats  ‚îÇ    ‚îÇ .parse_users_    ‚îÇ    ‚îÇ .qualify_    ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ          ‚îÇ    ‚îÇ  from_messages() ‚îÇ    ‚îÇ  lead()      ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                           ‚îÇ                                     ‚îÇ
‚îÇ                    returns (candidates,                          ‚îÇ
‚îÇ                     ‚òÖ all_messages) ‚òÖ                            ‚îÇ
‚îÇ                           ‚îÇ                                     ‚îÇ
‚îÇ                           ‚ñº                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ                  NEW: PAIN PIPELINE                     ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ pain_collector  ‚îÇ‚îÄ‚îÄ>‚îÇ pain_clusterer   ‚îÇ              ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ                 ‚îÇ   ‚îÇ                  ‚îÇ              ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ process_messages‚îÇ   ‚îÇ cluster_new_     ‚îÇ              ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (batch LLM)    ‚îÇ   ‚îÇ pains() (LLM)   ‚îÇ              ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ          ‚îÇ                      ‚îÇ                        ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ          ‚ñº                      ‚ñº                        ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  pains   ‚îÇ           ‚îÇ pain_clusters ‚îÇ                ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  (table) ‚îÇ           ‚îÇ   (table)     ‚îÇ                ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ                  NEW: CONTENT PIPELINE                   ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ content_generator  ‚îÇ‚îÄ‚îÄ>‚îÇ generated_posts  ‚îÇ          ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ                    ‚îÇ   ‚îÇ    (table)       ‚îÇ          ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ generate_post()    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (LLM, –ø–æ –∑–∞–ø—Ä–æ—Å—É)  ‚îÇ                                ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                 ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        BOT UI (aiogram 3.x)                     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  main_menu.py  ‚îÄ‚îÄ>  pains_handler.py                            ‚îÇ
‚îÇ  [üî• –ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç]                                            ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ üìä –¢–æ–ø –±–æ–ª–µ–π ‚îÄ‚îÄ> –î–µ—Ç–∞–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞                       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ ‚úçÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç ‚îÄ‚îÄ> –í—ã–±–æ—Ä —Ç–∏–ø–∞ ‚îÄ‚îÄ> –ß–µ—Ä–Ω–æ–≤–∏–∫     ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ üìù –ú–æ–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ ‚îÄ‚îÄ> –ü—Ä–æ—Å–º–æ—Ç—Ä/–¥–µ–π—Å—Ç–≤–∏—è                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
bot/models/pain.py              # ORM: Pain, PainCluster, GeneratedPost
modules/pain_collector.py       # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–π –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π (LLM –±–∞—Ç—á–∏)
modules/pain_clusterer.py       # –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–æ–ª–µ–π (LLM)
modules/content_generator.py    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ (LLM)
bot/handlers/pains_handler.py   # –í—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã UI –±–æ–ª–µ–π
bot/ui/pains_menu.py            # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤
prompts/pain_extraction.txt     # –ü—Ä–æ–º–ø—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–æ–ª–µ–π
prompts/pain_clustering.txt     # –ü—Ä–æ–º–ø—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
prompts/content_generation.txt  # –ü—Ä–æ–º–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤
```

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

```
modules/members_parser.py       # return (candidates, all_messages) –≤–º–µ—Å—Ç–æ candidates
bot/services/program_runner.py  # –≤—ã–∑–æ–≤ pain_collector + pain_clusterer –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
bot/ui/main_menu.py             # –∫–Ω–æ–ø–∫–∞ "üî• –ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç"
bot/main.py                     # import –º–æ–¥–µ–ª–µ–π + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞
bot/states.py                   # –Ω–æ–≤—ã–µ FSM-—Å—Ç–µ–π—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
config.py                       # PAIN_COLLECTION_ENABLED, PAIN_BATCH_SIZE
```

---

## Data Models (ORM)

### Pain

```python
class Pain(Base):
    __tablename__ = "pains"

    id: Mapped[int]                          # PK
    program_id: Mapped[int]                  # FK ‚Üí programs.id
    text: Mapped[str]                        # –û–ø–∏—Å–∞–Ω–∏–µ –±–æ–ª–∏ (LLM)
    original_quote: Mapped[str]              # –¶–∏—Ç–∞—Ç–∞ –∏–∑ —á–∞—Ç–∞
    category: Mapped[str]                    # operations/sales/communication/...
    intensity: Mapped[str]                   # low/medium/high
    business_type: Mapped[str | None]        # –¢–∏–ø –±–∏–∑–Ω–µ—Å–∞ (nullable)
    source_chat: Mapped[str]                 # Username —á–∞—Ç–∞
    source_message_id: Mapped[int]           # ID —Å–æ–æ–±—â–µ–Ω–∏—è
    source_message_link: Mapped[str | None]  # –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    source_user_id: Mapped[int | None]       # ID –∞–≤—Ç–æ—Ä–∞ (nullable)
    source_username: Mapped[str | None]      # Username –∞–≤—Ç–æ—Ä–∞ (nullable)
    message_date: Mapped[datetime]           # –î–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    collected_at: Mapped[datetime]           # –ö–æ–≥–¥–∞ —Å–æ–±—Ä–∞–Ω–∞
    cluster_id: Mapped[int | None]           # FK ‚Üí pain_clusters.id (nullable)
    used_in_post: Mapped[bool]               # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –ª–∏
```

### PainCluster

```python
class PainCluster(Base):
    __tablename__ = "pain_clusters"

    id: Mapped[int]                  # PK
    program_id: Mapped[int]          # FK ‚Üí programs.id
    name: Mapped[str]                # "–ü–æ—Ç–µ—Ä—è –∑–∞—è–≤–æ–∫ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö"
    category: Mapped[str]            # –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
    description: Mapped[str]         # –û–±–æ–±—â—ë–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    pain_count: Mapped[int]          # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–ª–µ–π
    avg_intensity: Mapped[float]     # –°—Ä–µ–¥–Ω—è—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
    first_seen: Mapped[datetime]     # –ü–µ—Ä–≤–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ
    last_seen: Mapped[datetime]      # –ü–æ—Å–ª–µ–¥–Ω–µ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ
    trend: Mapped[str]               # growing/stable/declining
    post_generated: Mapped[bool]     # –ë—ã–ª –ª–∏ –ø–æ—Å—Ç

    pains: relationship ‚Üí Pain[]
```

### GeneratedPost

```python
class GeneratedPost(Base):
    __tablename__ = "generated_posts"

    id: Mapped[int]                    # PK
    cluster_id: Mapped[int]            # FK ‚Üí pain_clusters.id
    post_type: Mapped[str]             # scenario/insight/breakdown
    title: Mapped[str]                 # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    body: Mapped[str]                  # –¢–µ–∫—Å—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∞
    status: Mapped[str]                # draft/edited/published/rejected
    generated_at: Mapped[datetime]     # –ö–æ–≥–¥–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
    published_at: Mapped[datetime | None]  # –ö–æ–≥–¥–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω

    cluster: relationship ‚Üí PainCluster
```

---

## API Contracts (–º–æ–¥—É–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)

### members_parser.py (–∏–∑–º–µ–Ω–µ–Ω–∏–µ)

```python
# –ë–´–õ–û:
async def parse_users_from_messages(...) -> list[dict]

# –°–¢–ê–õ–û:
async def parse_users_from_messages(...) -> tuple[list[dict], list[dict]]
#  returns: (candidates, all_messages)
#  all_messages: list of {message_id, text, date, chat_username, chat_id,
#                         is_public, link, sender_id, sender_username}
```

**–í–∞–∂–Ω–æ:** –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã `parse_users_from_messages()` –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å ‚Äî –≤ `program_runner.py` –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ç–µ–∂.

### pain_collector.py

```python
async def process_messages(
    messages: list[dict],
    chat_username: str,
    chat_id: int,
    program_id: int,
    session: AsyncSession
) -> int:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –±–æ–ª–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –±–∞—Ç—á–∞–º–∏ —á–µ—Ä–µ–∑ LLM.
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É pains.
    –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ (source_message_id, source_chat).

    Returns: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –±–æ–ª–µ–π.
    """

async def _extract_pains_batch(
    messages_batch: list[dict],
    chat_name: str
) -> list[dict]:
    """–û–¥–∏–Ω LLM-–≤—ã–∑–æ–≤ –Ω–∞ –±–∞—Ç—á 20-30 —Å–æ–æ–±—â–µ–Ω–∏–π."""
```

### pain_clusterer.py

```python
async def cluster_new_pains(
    program_id: int,
    session: AsyncSession
) -> int:
    """
    –ë–µ—Ä—ë—Ç –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –±–æ–ª–∏ (cluster_id IS NULL).
    –ß–µ—Ä–µ–∑ LLM —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ.
    –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤.

    Returns: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–æ–ª–µ–π.
    """

async def _update_cluster_stats(
    cluster_id: int,
    session: AsyncSession
) -> None:
    """–ü–µ—Ä–µ—Å—á—ë—Ç pain_count, avg_intensity, last_seen, trend."""
```

### content_generator.py

```python
async def generate_post(
    cluster_id: int,
    post_type: str,  # "scenario" | "insight" | "breakdown"
    session: AsyncSession
) -> GeneratedPost:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫ –ø–æ—Å—Ç–∞ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞.
    –ê–Ω–æ–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ü–∏—Ç–∞—Ç—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ LLM.

    Returns: —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π GeneratedPost.
    """

def anonymize_quotes(quotes: list[str]) -> list[str]:
    """–£–¥–∞–ª—è–µ—Ç @username, –∏–º–µ–Ω–∞, —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏."""
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.py)

```python
# Pain Collection
PAIN_COLLECTION_ENABLED = os.getenv("PAIN_COLLECTION_ENABLED", "true").lower() == "true"
PAIN_BATCH_SIZE = int(os.getenv("PAIN_BATCH_SIZE", 25))
```

–ù–æ–≤—ã—Ö env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ—Ç (LLM API —Ç–æ—Ç –∂–µ, –ë–î —Ç–∞ –∂–µ). –¢–æ–ª—å–∫–æ –¥–≤–∞ —Ñ–ª–∞–≥–∞.

---

## –ó–∞–¥–∞—á–∏

### Task 1: ORM-–º–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
**–§–∞–π–ª—ã:** `bot/models/pain.py`, `bot/main.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –°–æ–∑–¥–∞—Ç—å `bot/models/pain.py` —Å —Ç—Ä–µ–º—è –º–æ–¥–µ–ª—è–º–∏: `Pain`, `PainCluster`, `GeneratedPost`
2. –í `bot/main.py` –¥–æ–±–∞–≤–∏—Ç—å import –º–æ–¥–µ–ª–µ–π (—á—Ç–æ–±—ã `Base.metadata.create_all` —É–≤–∏–¥–µ–ª —Ç–∞–±–ª–∏—Ü—ã)
3. Unique constraint –Ω–∞ `pains`: `(source_message_id, source_chat)` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

**Acceptance Criteria:**
- [ ] –¢—Ä–∏ –º–æ–¥–µ–ª–∏ —Å type hints –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] FK-—Å–≤—è–∑–∏: Pain ‚Üí PainCluster, Pain ‚Üí Program, PainCluster ‚Üí Program, GeneratedPost ‚Üí PainCluster
- [ ] `create_all()` —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] UniqueConstraint –Ω–∞ (source_message_id, source_chat) –≤ Pain

---

### Task 2: Pain Extraction –ø—Ä–æ–º–ø—Ç
**–§–∞–π–ª—ã:** `prompts/pain_extraction.txt`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ ADDON_2.md (—Ä–∞–∑–¥–µ–ª 1.1)
2. –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∏–Ω–¥–µ–∫—Å–æ–º
3. –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: JSON `{"pains": [...]}`
4. 10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–æ–ª–µ–π –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**Acceptance Criteria:**
- [ ] –ü—Ä–æ–º–ø—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- [ ] JSON-—Å—Ö–µ–º–∞ –≤—ã—Ö–æ–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –í—Å–µ 10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: 1 —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí 0-N –±–æ–ª–µ–π, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∞–º

---

### Task 3: Pain Collector –º–æ–¥—É–ª—å
**–§–∞–π–ª—ã:** `modules/pain_collector.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Task 1, Task 2

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. `process_messages()` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ –±–∞—Ç—á–∏ –ø–æ `PAIN_BATCH_SIZE`
2. `_extract_pains_batch()` ‚Äî –æ–¥–∏–Ω LLM-–≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `langchain_openai.ChatOpenAI` (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å llm –∏–∑ qualifier –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π)
3. –ü–∞—Ä—Å–∏–Ω–≥ JSON-–æ—Ç–≤–µ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ AsyncSession
5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ `(source_message_id, source_chat)` –ø–µ—Ä–µ–¥ INSERT
6. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await llm.ainvoke()`** –≤–º–µ—Å—Ç–æ `llm.invoke()` (async)

**Acceptance Criteria:**
- [ ] –ë–∞—Ç—á–∏–Ω–≥ –ø–æ PAIN_BATCH_SIZE —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] Async LLM-–≤—ã–∑–æ–≤—ã (`ainvoke`)
- [ ] JSON –ø–∞—Ä—Å–∏–Ω–≥ —Å fallback –Ω–∞ –æ—à–∏–±–∫—É (–ø—Ä–æ–ø—É—Å–∫ –±–∞—Ç—á–∞, –Ω–µ crash)
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ (source_message_id, source_chat)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–ª–µ–π –∑–∞ –±–∞—Ç—á, –æ–±—â–µ–µ –∑–∞ –∑–∞–ø—É—Å–∫
- [ ] –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ (config.get_delay("between_requests"))

---

### Task 4: –ò–∑–º–µ–Ω–µ–Ω–∏–µ members_parser.py
**–§–∞–π–ª—ã:** `modules/members_parser.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –°–æ–±–∏—Ä–∞—Ç—å **–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è** (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ user'–∞–º) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ `all_messages`
2. –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: `{message_id, text, date, chat_username, chat_id, is_public, link, sender_id, sender_username}`
3. –í–µ—Ä–Ω—É—Ç—å `(candidates, all_messages)` –≤–º–µ—Å—Ç–æ `candidates`
4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø `main()` test function

**–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –í —Ü–∏–∫–ª–µ `async for message in client.iter_messages(...)` —É–∂–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `message.text` –∏ `sender`
- –î–æ–±–∞–≤–∏—Ç—å —Å–±–æ—Ä –≤ `all_messages` **–¥–æ** —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ `sender.bot / sender.deleted / sender.username`
- –î–ª—è Pain Collector –Ω—É–∂–Ω—ã –í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ username

**Acceptance Criteria:**
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç tuple (candidates, all_messages)
- [ ] all_messages —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç users —Å username)
- [ ] –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–º–µ–µ—Ç sender_id, sender_username (nullable), message_id, text, date, link
- [ ] –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ candidates –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç–∞

---

### Task 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ program_runner.py
**–§–∞–π–ª—ã:** `bot/services/program_runner.py`, `config.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Task 3, Task 4

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –í `config.py` –¥–æ–±–∞–≤–∏—Ç—å `PAIN_COLLECTION_ENABLED` –∏ `PAIN_BATCH_SIZE`
2. –í `run_program_pipeline()`:
   - –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å `(candidates, all_messages) = await members_parser.parse_users_from_messages(...)`
   - –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞: –≤—ã–∑–≤–∞—Ç—å `pain_collector.process_messages()` –µ—Å–ª–∏ enabled
   - –í –∫–æ–Ω—Ü–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–ø–µ—Ä–µ–¥ return): –≤—ã–∑–≤–∞—Ç—å `pain_clusterer.cluster_new_pains()` –µ—Å–ª–∏ enabled
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –±–æ–ª–µ–π

**Acceptance Criteria:**
- [ ] `PAIN_COLLECTION_ENABLED=false` ‚Üí pain collection –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ç–µ–∂–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] Pain collection –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω (–æ—à–∏–±–∫–∏ –ª–æ–≤—è—Ç—Å—è, –ª–æ–≥–∏—Ä—É—é—Ç—Å—è)
- [ ] –í—ã–∑–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —á–∞—Ç–æ–≤

---

### Task 6: Pain Clustering –ø—Ä–æ–º–ø—Ç + –º–æ–¥—É–ª—å
**–§–∞–π–ª—ã:** `prompts/pain_clustering.txt`, `modules/pain_clusterer.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Task 1

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –ü—Ä–æ–º–ø—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ ADDON_2.md (—Ä–∞–∑–¥–µ–ª 1.3)
2. `cluster_new_pains()`:
   - SELECT –±–æ–ª–∏ —Å `cluster_id IS NULL` –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ program_id
   - SELECT —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
   - –û–¥–∏–Ω LLM-–≤—ã–∑–æ–≤: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ–≤—ã–µ –±–æ–ª–∏ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –µ—Å–ª–∏ LLM —Ä–µ—à–∏–ª
   - UPDATE pain.cluster_id
3. `_update_cluster_stats()`:
   - –ü–µ—Ä–µ—Å—á—ë—Ç `pain_count` (COUNT), `avg_intensity` (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ low=1, medium=2, high=3 ‚Üí —Å—Ä–µ–¥–Ω–µ–µ), `last_seen` (MAX message_date), `first_seen` (MIN)
   - `trend`: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–æ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π vs –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 7 –¥–Ω–µ–π

**Acceptance Criteria:**
- [ ] –ù–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –±–æ–ª–∏ ‚Üí LLM ‚Üí –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
- [ ] –ù–æ–≤—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞
- [ ] –¢—Ä–µ–Ω–¥: growing –µ—Å–ª–∏ count_7d > count_prev_7d * 1.2, declining –µ—Å–ª–∏ < 0.8, stable –∏–Ω–∞—á–µ
- [ ] –ï—Å–ª–∏ –Ω–µ—Ç –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–æ–ª–µ–π ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å (no LLM call)

---

### Task 7: Bot UI ‚Äî –∫–Ω–æ–ø–∫–∞ –∏ –º–µ–Ω—é –±–æ–ª–µ–π
**–§–∞–π–ª—ã:** `bot/ui/main_menu.py`, `bot/ui/pains_menu.py`, `bot/handlers/pains_handler.py`, `bot/main.py`, `bot/states.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Task 1

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. `main_menu.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É `üî• –ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç` (callback_data="pains_menu")
2. `pains_menu.py` ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã:
   - `get_pains_menu_keyboard()` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ–ª–µ–π
   - `format_pains_summary()` ‚Äî —Ç–µ–∫—Å—Ç —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
   - `format_top_pains()` ‚Äî —Ç–æ–ø-5 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º
   - `format_cluster_detail()` ‚Äî –¥–µ—Ç–∞–ª–∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
   - `get_cluster_keyboard()` ‚Äî –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞
3. `pains_handler.py` ‚Äî —Ö–µ–Ω–¥–ª–µ—Ä—ã:
   - `pains_menu` ‚Äî —ç–∫—Ä–∞–Ω –±–æ–ª–µ–π —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
   - `top_pains` ‚Äî —Ç–æ–ø –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —Å —Ñ–æ—Ä–º—É–ª–æ–π —Ä–µ–π—Ç–∏–Ω–≥–∞
   - `cluster_detail_{id}` ‚Äî –¥–µ—Ç–∞–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
   - `cluster_quotes_{id}` ‚Äî –≤—Å–µ —Ü–∏—Ç–∞—Ç—ã (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
4. `main.py` ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä
5. `states.py` ‚Äî —Å—Ç–µ–π—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω—ã

**–§–æ—Ä–º—É–ª–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏):**
```
score = pain_count √ó 2 + freshness_bonus + intensity_bonus - already_posted_penalty

freshness_bonus = 3 –µ—Å–ª–∏ last_seen < 3 –¥–Ω–µ–π, 1 –µ—Å–ª–∏ < 7 –¥–Ω–µ–π, 0 –∏–Ω–∞—á–µ
intensity_bonus = avg_intensity √ó 2 (high=3, medium=2, low=1)
already_posted_penalty = 10 –µ—Å–ª–∏ post_generated = true
```

**Acceptance Criteria:**
- [ ] –ö–Ω–æ–ø–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –≠–∫—Ä–∞–Ω "–ë–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Å–æ–±—Ä–∞–Ω–æ –±–æ–ª–µ–π, –∫–ª–∞—Å—Ç–µ—Ä–æ–≤, –ø–æ—Å—Ç–æ–≤)
- [ ] –¢–æ–ø –±–æ–ª–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ 5 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —Ñ–æ—Ä–º—É–ª–µ
- [ ] –î–µ—Ç–∞–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ + 3 –ø—Ä–∏–º–µ—Ä–∞ —Ü–∏—Ç–∞—Ç + –∫–Ω–æ–ø–∫–∏
- [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è: –Ω–∞–∑–∞–¥ –∫ —Ç–æ–ø –±–æ–ª–µ–π, –Ω–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

---

### Task 8: Content Generation –ø—Ä–æ–º–ø—Ç + –º–æ–¥—É–ª—å
**–§–∞–π–ª—ã:** `prompts/content_generation.txt`, `modules/content_generator.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Task 1, Task 6

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –ü—Ä–æ–º–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ ADDON_2.md (—Ä–∞–∑–¥–µ–ª 2.2) ‚Äî —Ç—Ä–∏ —Ç–∏–ø–∞ –ø–æ—Å—Ç–æ–≤
2. `generate_post()`:
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä + –µ–≥–æ –±–æ–ª–∏ –∏–∑ –ë–î
   - –í—ã–±—Ä–∞—Ç—å 5-7 —Ü–∏—Ç–∞—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
   - –ê–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã
   - LLM-–≤—ã–∑–æ–≤ ‚Üí JSON {title, body, hashtags}
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å GeneratedPost —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "draft"
   - –ü–æ–º–µ—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä `post_generated = True`
3. `anonymize_quotes()`:
   - Regex: `@\w+` ‚Üí `[–∞–≤—Ç–æ—Ä]`
   - Regex: `t\.me/\w+` ‚Üí `[—Å—Å—ã–ª–∫–∞]`
   - –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Acceptance Criteria:**
- [ ] –¢—Ä–∏ —Ç–∏–ø–∞ –ø–æ—Å—Ç–æ–≤: scenario, insight, breakdown
- [ ] –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è: @username —É–¥–∞–ª–µ–Ω—ã, —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã
- [ ] –ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ generated_posts —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "draft"
- [ ] –ö–ª–∞—Å—Ç–µ—Ä –ø–æ–º–µ—á–∞–µ—Ç—Å—è post_generated=True
- [ ] –î–ª–∏–Ω–∞ –ø–æ—Å—Ç–∞: 800-1500 —Å–∏–º–≤–æ–ª–æ–≤ (–∑–∞–¥–∞–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç–µ)

---

### Task 9: Bot UI ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∏
**–§–∞–π–ª—ã:** `bot/handlers/pains_handler.py`, `bot/ui/pains_menu.py`
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** Task 7, Task 8

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –•–µ–Ω–¥–ª–µ—Ä –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –ø–æ—Å—Ç–∞: `generate_post_{cluster_id}`
   - –ü–æ–∫–∞–∑–∞—Ç—å 3 –∫–Ω–æ–ø–∫–∏: –°—Ü–µ–Ω–∞—Ä–∏–π / –ò–Ω—Å–∞–π—Ç / –†–∞–∑–±–æ—Ä —Ç—Ä–µ–Ω–¥–∞
2. –•–µ–Ω–¥–ª–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: `gen_{type}_{cluster_id}`
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å "‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é —á–µ—Ä–Ω–æ–≤–∏–∫..."
   - –í—ã–∑–≤–∞—Ç—å `content_generator.generate_post()`
   - –ü–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ + –∫–Ω–æ–ø–∫–∏ (–ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å / —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å / –æ—Ç–±—Ä–æ—Å–∏—Ç—å)
3. –•–µ–Ω–¥–ª–µ—Ä "–ú–æ–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∏": `my_drafts`
   - –°–ø–∏—Å–æ–∫ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
   - –î–µ–π—Å—Ç–≤–∏—è: –æ—Ç–º–µ—Ç–∏—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–º, –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª–∏—Ç—å

**Acceptance Criteria:**
- [ ] –í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–æ—Å—Ç–∞ –∏–∑ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ß–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
- [ ] –°–ø–∏—Å–æ–∫ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- [ ] –û—Ç–º–µ—Ç–∫–∞ "–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ" –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ published_at
- [ ] –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –ø–æ—Å—Ç (–Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç)

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
Task 1 (ORM –º–æ–¥–µ–ª–∏) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
Task 2 (Pain Extraction –ø—Ä–æ–º–ø—Ç) ‚îÄ‚îÄ‚îê              ‚îÇ
Task 4 (members_parser –∏–∑–º–µ–Ω–µ–Ω–∏–µ) ‚îÇ              ‚îÇ
                                   ‚ñº              ‚îÇ
                          Task 3 (Pain Collector) ‚îÇ
                                   ‚îÇ              ‚îÇ
                                   ‚ñº              ‚ñº
                          Task 5 (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è) ‚Üê Task 6 (Clustering)
                                                  ‚îÇ
                                                  ‚ñº
                                          Task 7 (Bot UI –º–µ–Ω—é)
                                                  ‚îÇ
                                          Task 8 (Content Gen)
                                                  ‚îÇ
                                                  ‚ñº
                                          Task 9 (Bot UI –∫–æ–Ω—Ç–µ–Ω—Ç)
```

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:** Tasks 1, 2, 4 ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã, –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

---

## Risk Register

| # | –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|---|------|-------------|---------|-----------|
| R1 | LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON | –°—Ä–µ–¥–Ω—è—è | –ü–æ—Ç–µ—Ä—è –±–∞—Ç—á–∞ –±–æ–ª–µ–π | try/except, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ raw response, –ø—Ä–æ–ø—É—Å–∫ –±–∞—Ç—á–∞ |
| R2 | –î—É–±–ª–∏–∫–∞—Ç—ã –±–æ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ | –í—ã—Å–æ–∫–∞—è | –ò—Å–∫–∞–∂—ë–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | UniqueConstraint + INSERT ON CONFLICT DO NOTHING |
| R3 | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (>100) | –ù–∏–∑–∫–∞—è | LLM —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç | –õ–∏–º–∏—Ç 50 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–µ, –º–µ—Ä–∂ ‚Äî –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ |
| R4 | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ event loop –ø—Ä–∏ LLM | –í—ã—Å–æ–∫–∞—è | –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ainvoke()` –≤–æ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—è—Ö |
| R5 | –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è | –ù–∏–∑–∫–∞—è | –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö | Regex-—Ñ–∏–ª—å—Ç—Ä + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ø—Ä–æ–º–ø—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |

---

## Tech Lead Validation

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| Type hints | ‚úÖ | –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å type hints |
| Docstrings | ‚úÖ | Public API –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω |
| PEP 8 / snake_case | ‚úÖ | –°–ª–µ–¥—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Å—Ç–∏–ª—é |
| Line length 88 | ‚úÖ | Black-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ |
| Separation of concerns | ‚úÖ | modules/ = –ª–æ–≥–∏–∫–∞, bot/ = UI, prompts/ = –¥–∞–Ω–Ω—ã–µ |
| Existing patterns | ‚úÖ | LLM —á–µ—Ä–µ–∑ langchain, ORM —á–µ—Ä–µ–∑ SQLAlchemy async |
| Minimal changes | ‚úÖ | 6 –∏–∑–º–µ–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤, 9 –Ω–æ–≤—ã—Ö |
| No breaking changes | ‚ö†Ô∏è | members_parser return type –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã |

### Verdict: APPROVED ‚úÖ

**–ó–∞–º–µ—á–∞–Ω–∏—è:**
1. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ return type `parse_users_from_messages()` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç –≤ `main()` —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ainvoke()` –≤–æ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö LLM-–≤—ã–∑–æ–≤–∞—Ö (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å tech debt –∏–∑ qualifier.py)
3. –ü—Ä–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `INSERT ... ON CONFLICT DO NOTHING` –≤–º–µ—Å—Ç–æ SELECT+INSERT

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** `/implement`
